<!DOCTYPE html>
<html>
  <head>
    <title>Parcel Sandbox</title>
    <meta charset="UTF-8" />
  </head>

  <body>
    <div>
      Test page
      <button id="app">Check Url</button>
    </div>
    <script>
      window.addEventListener("message", function(ev) {
  if (ev.data.message === "deliverResult") {
      alert("result: " + ev.data.result);
      ev.source.close();
  }
});
      
function previewClient(websiteLink) {
  var child = window.open(websiteLink, "_blank");
  var leftDomain = false;
  var interval = setInterval(function() {
      try {
          if (child.document.domain === document.domain) {
              if (leftDomain && child.document.readyState === "complete") {
                  // we're here when the child window returned to our domain
                  clearInterval(interval);
                  alert("returned: " + child.document.URL);
                  child.postMessage({ message: "requestResult" }, "https://apteline.pl");
              }
          }
          else {
              // this code should never be reached, 
              // as the x-site security check throws
              // but just in case
              leftDomain = true;
          }
      }
      catch(e) {
        console.log("error", e)
          // we're here when the child window has been navigated away or closed
          if (child.closed) {
              clearInterval(interval);
              alert("closed");
              return; 
          }
          // navigated to another domain  
          leftDomain = true;
      }
  }, 500);
}
const el = document.getElementById('app');
el.addEventListener('click', e => {
  const url = 'https://apteline.pl/?_vwo_m=%7B%22_vwo_cc%22%3A%7B%22app%22%3A%22local%22%2C%22enteredUrl%22%3A%22https%3A%2F%2Fapteline.pl%2F%22%2C%22accountId%22%3A735612%7D%7D';
  previewClient(url)
})
    </script>
  </body>
</html>
